---
description: Next.js のビルドキャッシュ問題とトラブルシューティング。チャンク404エラーやビルド関連の問題を扱う際に適用
globs: "**/.next/**/*,**/app/**/*.{ts,tsx},**/pages/**/*.{ts,tsx},next.config.*"
alwaysApply: false
---

# Next.js ビルドキャッシュとトラブルシューティング

## チャンク404エラーの対処

`_next/static/chunks` が見つからないエラーが発生した場合：

### 即座に試す解決策

```bash
# 1. ビルドキャッシュをクリア
rm -rf .next

# 2. 開発サーバーを再起動
npm run dev
```

### それでも解決しない場合

```bash
# node_modules も含めて完全クリア
rm -rf .next node_modules package-lock.json
npm install
npm run dev
```

## 重要な注意点

- **環境変数変更後は必ず再起動**: `.env` ファイルを変更した後は開発サーバーを再起動
- **ルーティンググループの扱い**: `(group)` 形式のフォルダは URL パスには影響しないが、チャンクパスには反映される
- **ビルドエラーの確認**: ターミナルのエラーメッセージを常に確認

## 予防策

### 開発時のベストプラクティス

1. 大きな変更後は `.next` フォルダを削除
2. 開発サーバーのターミナル出力を常に確認
3. 定期的に `npm run build` で本番ビルドを確認

### キャッシュクリアのタイミング

以下の場合にキャッシュをクリアすることを推奨：

- ルーティング構造を変更した後
- 環境変数を変更した後
- 依存関係を更新した後
- 予期しない動作が発生した場合

## 確認事項

エラー発生時に確認：

1. `.next` フォルダが存在するか
2. ターミナルにコンパイルエラーがないか
3. ページファイルが正しい場所にあるか
4. `export default` が正しく設定されているか
