---
name: maintain-architecture-doc
description: |
  ARCHITECTURE.md の新規作成・更新を行うスキル。
  人間が保守・引き継ぎするためのドキュメントを、コードの実態に基づいて生成・維持する。
---

## Purpose

プロジェクトの `ARCHITECTURE.md` を作成・更新し、
人間がコードを読む前に全体像を把握できる状態を維持する。

「コードの逐語的な説明」ではなく「人が引き継ぐための理解」を目的とする。

## Input

- プロジェクトのソースコード一式
- 変更があった場合は、変更内容の差分情報

## Output

- `ARCHITECTURE.md`（プロジェクトルート）の作成または更新
- 変更履歴セクションへの追記

## 必須セクション

ARCHITECTURE.md には以下の7セクションを必ず含めること:

1. **このコードが解決している問題と目的**
   - アプリが存在する理由、解決している課題
   - 現在のフェーズや制約

2. **アプリ全体の処理の流れ**
   - 起動時、主要操作のフローを文章で段階的に記述
   - コードの関数名やファイル名を含めて、追跡可能にする

3. **ディレクトリ・主要ファイルの役割と責務**
   - ディレクトリツリーと各ファイルの責務
   - API エンドポイント一覧（パス / メソッド / 役割）
   - 主要コンポーネントの責務一覧

4. **設計上の重要な判断点と、その理由**
   - 「何を選んだか」だけでなく「なぜ他を選ばなかったか」も記載
   - 将来のリスクや制約も明記

5. **前提条件・制約・暗黙のルール**
   - 技術的な前提（環境要件）
   - コードに明示されていない暗黙の規約
   - 依存関係のバージョン制約

6. **バグや仕様変更が起きやすいポイント**
   - 具体的な箇所（ファイル名・関数名）を明示
   - 重要度を付けて優先順位がわかるようにする

7. **人が必ず理解しておくべき箇所と、流し読みでよい箇所の区別**
   - 全ファイルを「必読 / 重点参照 / 流し読みでよい」に分類
   - 各分類の理由を簡潔に付記

## 補足セクション（推奨）

- データフロー図（テキストベース）
- 主要アルゴリズムの早見表
- 開発環境のセットアップ手順
- 変更履歴

## 実行ガイドライン

### 新規作成時

1. プロジェクト全体のディレクトリ構造を把握する
2. 全ソースファイルを読み取る（コンポーネント、ライブラリ、API、ストア、型定義、スキーマ）
3. 上記7セクション + 補足セクションを記述する
4. 変更履歴に「初版作成」を記録する

### 更新時

1. 変更された箇所を特定する
2. 影響を受けるセクションのみ更新する
3. 変更履歴に日付と変更内容を追記する
4. 無関係なセクションは触らない

### 記述の原則

- 推測で書かない。コードの実態に基づく
- 冗長な説明は避け、表形式を活用する
- ファイル名・関数名・変数名は正確に記載する
- 「なぜそうなっているか」を必ず添える
