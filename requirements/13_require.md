以下は既存ドキュメント（要件・技術スタック・アーキテクチャ・ルール）を
すべて理解・遵守したうえでの「実装順序と判断事項の補足」です。
既存仕様を上書きせず、この内容を前提条件として実装してください。

# 実装順序（固定）
1. レスポンシブデザイン
2. エラーハンドリング
3. NextAuth 認証
4. Turso 対応
5. Vercel デプロイ

※ Vercel はサーバーレスのため SQLite の永続化は不可。
※ Turso はデプロイ直前に導入する。

# NextAuth → Turso の順序に関する前提
- NextAuth は SQLite 環境で先に実装・動作確認する
- NextAuth 導入により以下の認証テーブルが Prisma スキーマに追加される
  - User
  - Account
  - Session
  - VerificationToken
- Deck / Card / StudyRecord に userId が追加される
- この時点でローカルの dev.db はリセット前提とする
- Turso 移行時は、認証テーブル込みの最終スキーマを一括で push する

# NextAuth のバージョンと方針
- Auth.js v5（next-auth v5）を使用する
- v4 の API / 記法は禁止
- App Router 構成
- セッション戦略は JWT を採用する
  - Database Session は使用しない

# IndexedDB に関する補足方針
- 画像データは引き続き IndexedDB に保存する
- マルチユーザー問題を防ぐため、
  IndexedDB の key には必ず userId プレフィックスを付与する
  例: image:{userId}:{cardId}

# アクセス制御の補足方針
- 未認証ユーザーはログインページ以外にアクセス不可
- ダッシュボード含め、全ページを保護対象とする
- Phase 1 では公開ページは作らない

# 手動セットアップの前提
- NextAuth 実装前に以下は完了済みとする
  - Google OAuth 設定
  - GitHub OAuth 設定
  - Secret（AUTH_SECRET 等）の設定
- Turso のセットアップは NextAuth 実装後でよい

# 追加要件 (UI/UX改善)
1. **ダッシュボード変更**
   - 「今日の復習 - 定着率」を削除
   - 代わりに「日別の学習枚数グラフ」を表示する

2. **自由学習モード (Free Study) の仕様変更**
   - 定着率（SRSデータ）には影響を与えない
   - 回答ボタン（Easy/Good/Hard/Again）は表示しない
   - 「次へ」ボタンと「終了」ボタンのみ表示する
   - 終了後、再度デッキから自由学習を選択した際、「続きから」か「初めから」を選択可能にする
     - 「続きから」: 前回中断したカードの次から開始
     - 「初めから」: 全カードをシャッフル（または順不同）で開始
     - ※「続きから」を実現するためには、学習セッションの状態（どこまで進んだか）を何らかの形で保持する必要がある（ローカルステート or DB）今回は簡易的にローカルストレージまたはDBの一時テーブルを利用するか検討が必要だが、要件としては「中断再開」が必要。
     - **実装方針:** `StudySession` モデルを追加実装するか、既存の `StudyRecord` とは別の管理方法を検討する。今回はシンプルに `localStorage` を活用して「中断したインデックス」をデッキIDごとに保存するアプローチを推奨。
