# 技術スタック決定 (TECH_STACK_DECISIONS)

## 1. 概要

Phase 1（ローカル完結型 MVP）で採用する技術スタックを、要件定義および QA 回答に基づき確定する。

---

## 2. コア技術

| カテゴリ       | 技術              | バージョン方針   | 理由                                               |
| -------------- | ----------------- | ---------------- | -------------------------------------------------- |
| フレームワーク | Next.js           | 最新安定版       | フルスタック React フレームワーク。App Router 採用 |
| 言語           | TypeScript        | 最新安定版       | 型安全性によるコード品質向上                       |
| UI ライブラリ  | MUI (Material-UI) | **v5（安定版）** | QA 回答に基づき安定性重視                          |
| ルーティング   | App Router        | -                | QA 回答に基づき最新推奨方式を採用                  |
| ホスティング   | Vercel            | -                | Next.js との最適な互換性                           |

## 3. 状態管理・データ永続化

| カテゴリ         | 技術                  | 理由                                                         |
| ---------------- | --------------------- | ------------------------------------------------------------ |
| 状態管理         | Zustand               | 軽量・シンプル。クライアント側キャッシュとして使用           |
| ORM              | Prisma                | 型安全な DB アクセス。将来的な DB 切り替えにも対応           |
| データベース     | SQLite（Prisma 経由） | ファイルベースで簡単に利用可能。本番は PostgreSQL 等に切替可 |
| 画像データ永続化 | IndexedDB             | 大容量 Blob データの保存に対応                               |

### データフローの構成方針

- Zustand ストアはクライアント側のキャッシュとして機能（`persist` は不使用）
- データの永続化は **API Routes → Prisma → SQLite** の経路で実施
- アプリ起動時に `DataInitializer` コンポーネントが API から全データをフェッチ
- 画像データのみ IndexedDB に分離して保存（idb ライブラリ使用）
- ストアは機能単位で分割: `useDeckStore`, `useCardStore`, `useStudyStore`

## 4. Markdown エディタ

| カテゴリ               | 技術                            | 理由                                                |
| ---------------------- | ------------------------------- | --------------------------------------------------- |
| 入力方式               | プレーンテキスト + プレビュー型 | QA 回答に基づき B 方式を採用                        |
| Markdown パーサー      | react-markdown                  | 軽量で広く使われている React 用 Markdown レンダラー |
| シンタックスハイライト | react-syntax-highlighter        | コードブロックのハイライト対応                      |

## 5. 主要ライブラリ一覧

| ライブラリ                          | 用途                               |
| ----------------------------------- | ---------------------------------- |
| `@mui/material`                     | UI コンポーネント                  |
| `@mui/icons-material`               | アイコン                           |
| `@emotion/react`, `@emotion/styled` | MUI v5 のスタイリングエンジン      |
| `zustand`                           | 状態管理（クライアントキャッシュ） |
| `@prisma/client`                    | Prisma ORM クライアント            |
| `@prisma/adapter-better-sqlite3`    | SQLite 用ドライバーアダプター      |
| `idb`                               | IndexedDB 操作の Promise ラッパー  |
| `react-markdown`                    | Markdown レンダリング              |
| `react-syntax-highlighter`          | コードブロックハイライト           |
| `remark-gfm`                        | GitHub Flavored Markdown 対応      |
| `uuid`                              | カード・デッキの ID 生成           |
| `date-fns`                          | 日付操作（SRS スケジュール計算）   |
| `dotenv`                            | 環境変数読み込み（Prisma 設定用）  |

## 6. 開発ツール

| ツール   | 用途                                   |
| -------- | -------------------------------------- |
| ESLint   | コード品質チェック（Next.js 標準構成） |
| Prettier | コードフォーマッタ                     |

## 7. テスト方針

- Phase 1 ではテストなし（スピード優先）
- コードは一週間後にソースを見ても理解できるレベルの可読性を維持
- 命名規則・コメントで意図を明確にする

## 8. 制約事項

- Node.js バージョンと各ライブラリの互換性に注意（QA 回答より）
- 画像: 1 枚あたり最大 3MB、JPEG/PNG/GIF/WebP のみ対応、圧縮/リサイズなし
- Chrome 拡張・PWA 対応は Phase 1 完成後に対応
